!function(y){y.fn.uploadify=function(i){var e={fileTypeExts:"",uploader:"",auto:!1,method:"post",multi:!1,formData:{},fileObjName:"filedata",fileSizeLimit:2048,showUploadedPercent:!0,showUploadedSize:!1,buttonText:"",removeTimeout:1e3,itemTemplate:'<div id="${fileID}" class="uploadify-queue-item "><div class="uploadify-progress"><div class="uploadify-progress-bar"></div></div><span class="up_filename">${fileName}</span><span class="uploadbtn">上传</span><span class="delfilebtn">删除</span></div>',breakPoints:!1,isBurst:!0,fileSplitSize:1048576,getFileSizeUrl:"",isCn:!0,getUploadedSize:function l(i){var e=0;try{y.ajax({url:x.getFileSizeUrl,async:!1,type:"post",dataType:"json",data:{fileMd5:i.md5,fileSplitSize:x.fileSplitSize,fileName:i.name,totalSize:i.size},success:function t(i){i.success?e=i.size:(e=-1,Fai.ing(i.msg))}})}catch(a){console.warn(a)}return e},saveUploadedSize:null,saveInfoLocal:!1,onUploadStart:null,onUploadSuccess:null,onUploadComplete:null,onUploadError:null,onInit:null,onCancel:null,onSelect:null},x=y.extend(e,i),p=(function a(i){x.uploader=i},function o(i,e){return 1048576<i&&!e?(Math.round(100*i/1048576)/100).toString()+"MB":(Math.round(100*i/1024)/100).toString()+"KB"},function p(i,e){for(var t=0;t<e.length;t++)if(e[t].index==i)return e[t];return!1}),f=function f(i){for(var e=[],t=i.split(";"),a=0,p=t.length;a<p;a++)e.push(t[a].split(".").pop());return e},t={acx:["application/internet-property-stream"],ai:["application/postscript"],aif:["audio/x-aiff"],aifc:["audio/x-aiff"],aiff:["audio/x-aiff"],asf:["video/x-ms-asf"],asr:["video/x-ms-asf"],asx:["video/x-ms-asf"],au:["audio/basic"],avi:["video/x-msvideo"],axs:["application/olescript"],bas:["text/plain"],bcpio:["application/x-bcpio"],bin:["application/octet-stream"],bmp:["image/bmp"],c:["text/plain"],cat:["application/vnd.ms-pkiseccat"],cdf:["application/x-cdf"],cer:["application/x-x509-ca-cert"],"class":["application/octet-stream"],clp:["application/x-msclip"],cmx:["image/x-cmx"],cod:["image/cis-cod"],cpio:["application/x-cpio"],crd:["application/x-mscardfile"],crl:["application/pkix-crl"],crt:["application/x-x509-ca-cert"],csh:["application/x-csh"],css:["text/css"],dcr:["application/x-director"],der:["application/x-x509-ca-cert"],dir:["application/x-director"],dll:["application/x-msdownload"],dms:["application/octet-stream"],doc:["application/msword"],docx:["application/vnd.openxmlformats-officedocument.wordprocessingml.document"],dot:["application/msword"],dvi:["application/x-dvi"],dxr:["application/x-director"],eps:["application/postscript"],etx:["text/x-setext"],evy:["application/envoy"],exe:["application/x-msdownload"],fif:["application/fractals"],flr:["x-world/x-vrml"],flv:[".flv"],gif:["image/gif"],gtar:["application/x-gtar"],h:["text/plain"],hdf:["application/x-hdf"],hlp:["application/winhlp"],hqx:["application/mac-binhex40"],hta:["application/hta"],htc:["text/x-component"],htm:["text/html"],html:["text/html"],htt:["text/webviewhtml"],ico:["image/x-icon"],ief:["image/ief"],iii:["application/x-iphone"],ins:["application/x-internet-signup"],isp:["application/x-internet-signup"],jfif:["image/pipeg"],jpe:["image/jpeg"],jpeg:["image/jpeg"],jpg:["image/jpeg"],js:[".js"],json:["application/json"],latex:["application/x-latex"],lha:["application/octet-stream"],lsf:["video/x-la-asf"],lsx:["video/x-la-asf"],lzh:["application/octet-stream"],m13:["application/x-msmediaview"],m14:["application/x-msmediaview"],m3u:["audio/x-mpegurl"],man:["application/x-troff-man"],mdb:["application/x-msaccess"],me:["application/x-troff-me"],mht:["message/rfc822"],mhtml:["message/rfc822"],mid:["audio/mid"],mny:["application/x-msmoney"],mov:["video/quicktime"],movie:["video/x-sgi-movie"],mp2:["video/mpeg"],mp3:["audio/mpeg"],mpa:["video/mpeg"],mpe:["video/mpeg"],mpeg:["video/mpeg"],mpg:["video/mpeg"],mpp:["application/vnd.ms-project"],mpv2:["video/mpeg"],ms:["application/x-troff-ms"],mvb:["application/x-msmediaview"],mp4:["video/mp4"],nws:["message/rfc822"],oda:["application/oda"],p10:["application/pkcs10"],p12:["application/x-pkcs12"],p7b:["application/x-pkcs7-certificates"],p7c:["application/x-pkcs7-mime"],p7m:["application/x-pkcs7-mime"],p7r:["application/x-pkcs7-certreqresp"],p7s:["application/x-pkcs7-signature"],pbm:["image/x-portable-bitmap"],pdf:["application/pdf"],pfx:["application/x-pkcs12"],pgm:["image/x-portable-graymap"],pko:["application/ynd.ms-pkipko"],pma:["application/x-perfmon"],pmc:["application/x-perfmon"],pml:["application/x-perfmon"],pmr:["application/x-perfmon"],pmw:["application/x-perfmon"],pnm:["image/x-portable-anymap"],pot:["application/vnd.ms-powerpoint"],ppm:["image/x-portable-pixmap"],pps:["application/vnd.ms-powerpoint"],ppt:["application/vnd.ms-powerpoint"],pptx:["application/vnd.openxmlformats-officedocument.presentationml.presentation"],prf:["application/pics-rules"],ps:["application/postscript"],pub:["application/x-mspublisher"],png:["image/png"],qt:["video/quicktime"],ra:["audio/x-pn-realaudio"],ram:["audio/x-pn-realaudio"],ras:["image/x-cmu-raster"],rar:[".rar"],rgb:["image/x-rgb"],rmi:["audio/mid"],roff:["application/x-troff"],rtf:["application/rtf"],rtx:["text/richtext"],scd:["application/x-msschedule"],sct:["text/scriptlet"],setpay:["application/set-payment-initiation"],setreg:["application/set-registration-initiation"],sh:["application/x-sh"],shar:["application/x-shar"],sit:["application/x-stuffit"],snd:["audio/basic"],spc:["application/x-pkcs7-certificates"],spl:["application/futuresplash"],src:["application/x-wais-source"],sst:["application/vnd.ms-pkicertstore"],stl:["application/vnd.ms-pkistl"],stm:["text/html"],svg:["image/svg+xml"],sv4cpio:["application/x-sv4cpio"],sv4crc:["application/x-sv4crc"],swf:["application/x-shockwave-flash"],t:["application/x-troff"],tar:["application/x-tar"],tcl:["application/x-tcl"],tex:["application/x-tex"],texi:["application/x-texinfo"],texinfo:["application/x-texinfo"],tgz:["application/x-compressed"],tif:["image/tiff"],tiff:["image/tiff"],tr:["application/x-troff"],trm:["application/x-msterminal"],tsv:["text/tab-separated-values"],txt:["text/plain"],uls:["text/iuls"],ustar:["application/x-ustar"],vcf:["text/x-vcard"],vrml:["x-world/x-vrml"],wav:["audio/x-wav"],wcm:["application/vnd.ms-works"],wdb:["application/vnd.ms-works"],wks:["application/vnd.ms-works"],wmf:["application/x-msmetafile"],wma:["audio/x-ms-wma"],wps:["application/vnd.ms-works"],wri:["application/x-mswrite"],wrl:["x-world/x-vrml"],wrz:["x-world/x-vrml"],xaf:["x-world/x-vrml"],xbm:["image/x-xbitmap"],xla:["application/vnd.ms-excel"],xlc:["application/vnd.ms-excel"],xlm:["application/vnd.ms-excel"],xls:["application/vnd.ms-excel"],xlsx:["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],xlt:["application/vnd.ms-excel"],xlw:["application/vnd.ms-excel"],xof:["x-world/x-vrml"],xpm:["image/x-xpixmap"],xwd:["image/x-xwindowdump"],z:["application/x-compress"],zip:["application/x-zip-compressed"],"7z":["application/x7zcompressed"]},n=function n(i){return t[i]},v=function v(i){for(var e=f(i),t=[],a=0,p=e.length;a<p;a++){var l=n(e[a]);l&&t.push(l)}return t.join(",")},g=function g(i,e,t,a){e.open(x.method,i,!0),e.setRequestHeader("X-Requested-With","XMLHttpRequest");var p=new FormData;if(p.append(x.fileObjName,t,t.name),a)for(key in a)p.append(key,a[key]);e.send(p)},h=90;function z(i){if("start"==i.status){var e=['<div id="progressBody_'+i.id+'" class="bodyDisable"></div>','<div id="progressWrap_'+i.id+'" class="bodyProgressWrap">','<div class="progressCenter"></div>','<div class="progressIngBody">','<div id="progressTitle'+i.id+'" class="progressIngTitle">'+i.title+"</div>",'<div class="progressIngMission">','<div class="mission"><div id="progress'+i.id+'" class="progress" style="width:1%;"></div></div>','<div id="progressNum'+i.id+'" class="progressNum">0%</div>',"</div>",'<div class="progressInfo"><span class="progressFileSize">文件大小:'+Fai.parseFileSize(i.size)+'</span><a class="progressCancel" href="javascript:uploadCancel(\''+i.id+"');\">取消</a></div>","</div>","</div>"];y("body").append(e.join("")),h=90}else if("ing"==i.status){var t=i.percent;y("#progressTitle"+i.id).text(i.title);var a=b.fileFilter[0].name,p=f(a)[0].toLowerCase(),l=null==n(p)?"":n(p)[0];if(i.percent>h&&100!=i.percent){var o=Math.random()/5;h+=parseFloat(o.toFixed(2)),t=h=parseFloat(h.toFixed(2))}0<=l.indexOf("image")?(y("#progress"+i.id).css("width",t+"%"),y("#progressNum"+i.id).html(t+"%")):(y("#progress"+i.id).css("width",i.percent+"%"),y("#progressNum"+i.id).html(i.percent+"%")),y("#progress"+i.id).attr("width",i.percent),0<=l.indexOf("image")&&99<i.percent&&s(i.id)}else"end"==i.status?(y("#progressTitle"+i.id).text(i.title),y("#progressBody_"+i.id).remove(),y("#progressWrap_"+i.id).remove()):"error"==i.status&&y("#progress"+i.id).addClass("progressError")}function s(i){90!=h&&(100<(h+=.5)||(h=parseFloat(h.toFixed(2)),y("#progress"+i).css("width",h+"%"),y("#progressNum"+i).html(h+"%"),setTimeout(function(){s(i)},1e3)))}function S(i,e){return-1!==i.indexOf(e,i.length-e.length)}var b=null;function w(i){var e=x.uploader;for(key in i)e+="&"+key+"="+i[key];b.url=e}return this.each(function(){var i=y(this),m=y(".uploadify").length+1,e='<a id="file_upload_'+m+'-button" href="javascript:void(0)" class="uploadify-button '+(x.isCn?"":"uploadify-buttonLan")+'">';e+=x.buttonText,e+="</a>",e+='<input id="select_btn_'+m+'" class="selectbtn" style="visibility:hidden;width:72px;" type="file" name="fileselect[]"',e+=x.multi?" multiple":"",e+=' accept="',null==x.fileTypeExts||""==x.fileTypeExts||"*"==x.fileTypeExts||"*.*;"==x.fileTypeExts?e+="*.*":e+=v(x.fileTypeExts),e+='"/>';i.append(e),(b={xhr:null,uploadAllowed:!0,fileInput:i.find(".selectbtn"),uploadFileList:y(document).find(".uploadify-queue"),url:x.uploader,fileFilter:[],uploadOver:!1,filter:function s(i){var e=[],t=!1,a=f(x.fileTypeExts);if(""!=x.fileTypeExts&&"*.*"!=x.fileTypeExts&&null!=x.fileTypeExts&&"*.*;"!=x.fileTypeExts||(t=!0),0<a.length)for(var p=0,l=i.length;p<l;p++){var o=i[p];if(o.size>x.fileSizeLimit)x.siteFree?Fai.ing("免费版单个文件大小不超过"+x.fileSizeLimit/1024/1024+"MB，<a href='"+x.updateUrlViewRes+'\' target="_blank">点击了解各版本限制。</a>',!0):Fai.ing("单个文件不能超过"+x.fileSizeLimit/1024/1024+"MB",!0);else{var n=o.name;if(x.siteFree){if(S(n,".apk")){Fai.ing("上传失败：您的版本目前不支持上传apk文件。",!0);continue}if(S(n,".exe")){Fai.ing("上传失败：您的版本目前不支持上传exe文件。",!0);continue}if(S(n,".html")||S(n,".htm")){Fai.ing("上传失败：您的版本目前不支持上传html或htm文件。",!0);continue}}t?e.push(o):0<=y.inArray(o.name.split(".").pop().toLowerCase(),a)?e.push(o):Fai.ing("文件"+o.name+"类型不允许！",!0)}}return e},funSelect:function p(i){if(!x.onSelect||x.onSelect(i)){if(x.breakPoints)var e=this.funGetUploadedSize(i[0]);if(-1!=e){var t=(e/i[0].size*100).toFixed(2),a={status:"start",id:i[0].id,title:"准备上传.....",percent:t,size:i[0].size};z(a),x.breakPoints&&(z(a={status:"ing",id:i[0].id,title:"正在上传.....",percent:t}),this.funUploadFile(i[0]))}}else b.fileFilter=[]},onProgress:function d(i,e,t){var a=y("body").find("#progressWrap_"+i.id),p=e,l=a.attr("lastLoaded")||0;(e-=parseInt(l))<0&&(e=0);var o=y("#progress"+i.id),n=x.breakPoints?parseFloat(o.attr("width")):0;if(!(e<i.size)){var s=parseFloat(o.attr("old-loaded")||n/100*t)+i.size;o.attr("old-loaded",s);var r=(s/t*100).toFixed(0);r=100<=r?100:r,p<x.fileSplitSize?a.attr("lastLoaded",p):a.removeAttr("lastLoaded"),tmpoptions={status:"ing",id:i.id,title:"正在上传.....",percent:r},z(tmpoptions)}},funGetProgressWidth:function t(i){},funGetUploadedSize:function a(i){return x.getUploadedSize?x.getUploadedSize(i):x.saveInfoLocal?parseInt(localStorage.getItem(i.name))||0:void 0},funSaveUploadedSize:function l(i,e){x.saveUploadedSize?x.saveUploadedSize(i,e):x.saveInfoLocal&&localStorage.setItem(i.name,e)},funGetFiles:function o(i){for(var e=i.target.files,t=0,a=(e=this.filter(e)).length;t<a;t++)this.fileFilter.push(e[t]);if(0!=this.fileFilter.length)return this.funDealFiles(e),this;y(this.fileInput).val("")},funDealFiles:function n(i){for(var e=y(document).find(".uploadify-queue .uploadify-queue-item").length,t=0,a=i.length;t<a;t++)i[t].index=++e,i[t].id="fileupload_"+m+"_"+i[t].index,i[t].md5=y.md5(i[t].name+i[t].size+i[t].type+i[t].lastModified),x.isBurst&&(0<=i[t].size&&i[t].size<20971520?x.fileSplitSize=5242880:20971520<=i[t].size&&i[t].size<52428800?x.fileSplitSize=5242880:52428800<=i[t].size&&i[t].size<104857600?x.fileSplitSize=8388608:104857600<=i[t].size&&i[t].size<524288e3?x.fileSplitSize=10485760:x.fileSplitSize=15728640);return this.funSelect(i),this},funDeleteFile:function r(i){for(var e=0,t=this.fileFilter.length;e<t;e++){var a=this.fileFilter[e];if(a.index==i){x.breakPoints&&(this.uploadAllowed=!1),this.fileFilter.splice(e,1),y(document).find("#fileupload_"+m+"_"+i).fadeOut(),b.fileInput.val(""),x.onCancel&&x.onCancel(a);break}}return this},funUploadFile:function u(e){b.xhr=new XMLHttpRequest;var t=e,a=!1,i=y(document).find("#fileupload_"+m+"_"+e.index),p=function p(){b.uploadOver&&(i.find(".uploadify-progress-bar").css("width","100%"),x.showUploadedSize&&i.find(".uploadedsize").text(i.find(".totalsize").text()),x.showUploadedPercent&&i.find(".up_percent").text("100%"),x.onUploadSuccess&&x.onUploadSuccess(t,b.xhr.responseText),b.funDeleteFile(e.index),setTimeout(l,1500))},l=function l(){if(0!=b.fileFilter.length){var i=b.funGetUploadedSize(b.fileFilter[0])/b.fileFilter[0].size*100,e={status:"start",id:b.fileFilter[0].id,title:"准备上传.....",percent:i,size:b.fileFilter[0].size};z(e),z(e={status:"ing",id:b.fileFilter[0].id,title:"正在上传.....",percent:i}),b.funUploadFile(b.fileFilter[0])}};try{b.xhr=new XMLHttpRequest}catch(f){b.xhr=ActiveXobject("Msxml12.XMLHTTP")}if(x.breakPoints){var o=e.name,n=e.id,s=e.index,r=e.size,d=e.md5,c=parseInt(this.funGetUploadedSize(t));r>=x.fileSplitSize?(e=t.slice(c,c+x.fileSplitSize),a=!1,b.lastSplit=!1):(a=!0,b.lastSplit=!0),e.name=o,e.id=n,e.index=s,e.md5=d}b.xhr.upload&&!1!==c&&(b.xhr.upload.addEventListener("progress",function(i){b.onProgress(e,i.loaded,t.size)},!1),b.xhr.onreadystatechange=function(){if(4==b.xhr.readyState){if(b.uploadOver=!0,200==b.xhr.status){var i=JSON.parse(b.xhr.responseText);if(i.success)x.breakPoints?(c+=x.fileSplitSize,b.funSaveUploadedSize(t,r<=c?r:c),c<r?(b.uploadOver=!1,b.uploadAllowed&&(a=c+x.fileSplitSize>=r?(e=t.slice(c,r),!0):(e=t.slice(c,c+x.fileSplitSize),!1),e.name=o,e.id=n,e.index=s,e.size=r,x.formData.fileMd5=t.md5,x.formData.totalSize=t.size,x.formData.complete=a,x.formData.initSize=c,setTimeout(g(b.url,b.xhr,e,x.formData),2e3))):p()):p();else Fai.ing("文件："+e.name+"  "+i.msg,!0),z({status:"end",id:e.id}),b.uploadOver=!0,p()}else b.uploadOver&&x.onUploadError&&x.onUploadError(t,b.xhr.responseText);b.uploadOver&&(x.onUploadComplete&&x.onUploadComplete(t,b.xhr.responseText),b.fileInput.val(""),h=90)}},x.onUploadStart&&x.onUploadStart(e),x.formData.fileMd5=e.md5,x.formData.totalSize=t.size,x.formData.complete=a,x.formData.initSize=c,b.uploadAllowed=!0,w(x.post_params),g(b.url,b.xhr,e,x.formData))},init:function c(){0<this.fileInput.length&&this.fileInput.change(function(i){b.funGetFiles(i)}),i.find(".uploadify-button").on("click",function(){i.find(".selectbtn").trigger("click")}),x.onInit&&x.onInit()}}).init()}),{genUploadUrl:w,stop:function r(){b.xhr.abort(),b.uploadOver=!1,b.uploadAllowed=!1;for(var i=0,e=b.fileFilter.length;i<e;i++)b.funDeleteFile(++i);b.fileFilter=[]},upload:function d(i){if("*"===i){var e=e=b.fileFilter.length,t=0;for(e=b.fileFilter.length;t<e;t++)b.funUploadFile(b.fileFilter[t])}else{var a=p(i,b.fileFilter);a&&b.funUploadFile(a)}},cancel:function c(i){if((i="*")==i)for(var e=0,t=b.fileFilter.length;e<t;e++)b.funDeleteFile(++e);else b.funDeleteFile(i)},disable:function m(i){y(i?"file_upload_"+i+"-button":"body").find(".uploadify-button").css("background-color","#888").off("click")},ennable:function u(i){var e=y(i?"file_upload_"+i+"-button":"body");e.find(".uploadify-button").css("background-color","#707070").on("click",function(){e.find(".selectbtn").trigger("click")})}}}}(jQuery);